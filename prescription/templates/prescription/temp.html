<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doctor's Prescription ‚Äî Form + Preview</title>
<style>
  :root{
    --brand:#0b6efd;
    --ink:#1f2937;
    --muted:#6b7280;
    --paper:#ffffff;
    --bg:#f5f7fb;
    --border:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--ink);
    background:var(--bg);
  }
  header.appbar{
    position:sticky; top:0; z-index:5;
    background:#fff; border-bottom:1px solid var(--border);
    padding:10px 16px; display:flex; gap:10px; align-items:center; justify-content:space-between;
  }
  header .actions{display:flex; gap:8px; flex-wrap:wrap}
  button, .btn{
    background:var(--brand); color:#fff; border:none; border-radius:8px;
    padding:10px 14px; font-weight:600; cursor:pointer;
    box-shadow:0 1px 0 rgba(0,0,0,.04);
  }
  button.secondary{background:#eef2ff; color:#3730a3}
  button.ghost{background:transparent; color:var(--brand)}
  button:disabled{opacity:.5; cursor:not-allowed}
  .container{
    display:grid; grid-template-columns: 420px 1fr; gap:18px; padding:18px; max-width:1400px; margin:0 auto;
  }
  .card{
    background:var(--paper); border:1px solid var(--border); border-radius:12px; padding:16px;
    box-shadow:0 6px 20px rgba(18, 38, 63, .03);
  }
  .section-title{font-size:12px; letter-spacing:.08em; text-transform:uppercase; color:var(--muted); margin:4px 0 12px}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
  input, select, textarea{
    width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:8px; background:#fff;
    font:inherit; color:inherit; outline:none;
  }
  textarea{min-height:76px; resize:vertical}
  .med-table{width:100%; border-collapse:collapse}
  .med-table th,.med-table td{border-bottom:1px dashed #e6e6e6; padding:8px 6px; text-align:left; vertical-align:top}
  .med-table th{font-size:12px; color:var(--muted); font-weight:600}
  .med-actions{display:flex; gap:8px}
  .small{font-size:12px}
  .rx-preview{
    background:#fff; padding:26px; border:1px solid var(--border); border-radius:12px;
    width:100%; min-height:600px;
  }
  .rx-header{display:flex; align-items:center; justify-content:space-between; gap:16px}
  .rx-doc h1{margin:0; font-size:20px}
  .rx-doc p{margin:2px 0; color:var(--muted)}
  .rx-brand{font-weight:800; color:var(--brand)}
  .rx-divider{border:none; border-top:2px solid #111; margin:12px 0}
  .rx-grid{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  .rx-section h3{margin:12px 0 6px; font-size:14px; border-bottom:1px solid var(--border); padding-bottom:4px}
  .rx-ul{margin:6px 0 0 16px}
  .rx-footer{display:flex; justify-content:space-between; align-items:flex-end; margin-top:34px}
  .sig-box{height:60px; border-bottom:1px solid #111; min-width:240px}
  .badge{
    display:inline-block; padding:2px 8px; font-size:12px; background:#ecfeff; color:#0e7490; border:1px solid #a5f3fc; border-radius:999px;
  }
  .help{color:var(--muted)}
  .rx-table{width:100%; border-collapse:collapse; margin-top:6px}
  .rx-table th,.rx-table td{border:1px solid #ddd; padding:8px; font-size:13px}
  .rx-table th{background:#fafafa}
  /* Print styles */
  @media print{
    header.appbar, .form-panel{display:none !important}
    body{background:#fff}
    .container{display:block; padding:0}
    .card{border:none; box-shadow:none; padding:0}
    .rx-preview{border:none; border-radius:0; padding:18mm; width:auto}
  }
</style>
</head>
<body>
  <header class="appbar">
    <div class="brand"><span class="rx-brand">Rx</span> Builder</div>
    <div class="actions">
      <button type="button" class="secondary" id="fillDemo">Fill Demo</button>
      <button type="button" class="ghost" id="clearForm">Clear</button>
      <button type="button" onclick="window.print()">üñ®Ô∏è Print</button>
    </div>
  </header>

  <main class="container">
    <!-- LEFT: FORM -->
    <section class="card form-panel" aria-label="Prescription Form">
      <div class="section-title">Doctor & Clinic</div>
      <div class="row">
        <div>
          <label for="doctorName">Doctor Name</label>
          <input id="doctorName" placeholder="Dr. Jane Doe" />
        </div>
        <div>
          <label for="qualification">Qualification</label>
          <input id="qualification" placeholder="MBBS, MD (General Medicine)" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="clinic">Clinic/Hospital</label>
          <input id="clinic" placeholder="City Hospital" />
        </div>
        <div>
          <label for="contact">Contact</label>
          <input id="contact" placeholder="+1 234 567 8901 ¬∑ jane@hospital.com" />
        </div>
      </div>
      <hr style="border:none;border-top:1px solid var(--border); margin:14px 0">

      <div class="section-title">Patient</div>
      <div class="row">
        <div>
          <label for="patientName">Patient Name</label>
          <input id="patientName" placeholder="John Smith" />
        </div>
        <div>
          <label for="patientAge">Age</label>
          <input id="patientAge" inputmode="numeric" placeholder="35" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="gender">Gender</label>
          <select id="gender">
            <option value="">‚Äî</option>
            <option>Female</option>
            <option>Male</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
          </select>
        </div>
        <div>
          <label for="date">Date</label>
          <input id="date" type="date" />
        </div>
      </div>

      <div style="margin-top:10px">
        <label for="diagnosis">Diagnosis / Chief Complaint</label>
        <textarea id="diagnosis" placeholder="E.g., Upper respiratory tract infection; mild fever"></textarea>
      </div>

      <div style="margin-top:10px">
        <label for="notes">General Advice / Notes</label>
        <textarea id="notes" placeholder="Hydration, rest, monitor temperature. Return if symptoms persist > 5 days."></textarea>
      </div>

      <hr style="border:none;border-top:1px solid var(--border); margin:14px 0">

      <div class="section-title">Medications <span class="help">‚Äî add items below</span></div>
      <table class="med-table" aria-label="Medications">
        <thead>
          <tr>
            <th style="width:28%">Medicine</th>
            <th style="width:14%">Dose</th>
            <th style="width:18%">Frequency</th>
            <th style="width:18%">Duration</th>
            <th style="width:14%">Route</th>
            <th style="width:8%"></th>
          </tr>
        </thead>
        <tbody id="medBody">
          <!-- rows injected here -->
        </tbody>
      </table>
      <div class="med-actions" style="margin-top:10px">
        <button type="button" class="secondary" id="addMed">Ôºã Add Medicine</button>
        <button type="button" id="addCommon">‚òÖ Add Common Set</button>
      </div>

      <div style="margin-top:16px">
        <label for="followup" class="small">Follow-up (optional)</label>
        <input id="followup" placeholder="In 7 days or earlier if no improvement" />
      </div>
    </section>

    <!-- RIGHT: PREVIEW -->
    <section class="card">
      <div class="rx-preview" aria-label="Printable Preview">
        <div class="rx-header">
          <div class="rx-doc">
            <h1 id="vDoc">Dr. Jane Doe</h1>
            <p id="vQual">MBBS, MD (General Medicine)</p>
            <p id="vClinic">City Hospital</p>
            <p class="small" id="vContact">+1 234 567 8901 ¬∑ jane@hospital.com</p>
          </div>
          <div class="rx-meta" style="text-align:right">
            <div class="badge">Prescription</div><br>
            <span class="small" id="vDate"></span>
          </div>
        </div>

        <hr class="rx-divider">

        <div class="rx-grid">
          <div><strong>Patient:</strong> <span id="vPatient">John Smith</span></div>
          <div style="text-align:right"><strong>Age:</strong> <span id="vAge">35</span> &nbsp; <strong>Gender:</strong> <span id="vGender">‚Äî</span></div>
        </div>

        <div class="rx-section">
          <h3>Diagnosis / Complaint</h3>
          <div id="vDiag" class="small">‚Äî</div>
        </div>

        <div class="rx-section">
          <h3>Medications</h3>
          <table class="rx-table" id="vMeds">
            <thead>
              <tr>
                <th>Medicine</th><th>Dose</th><th>Frequency</th><th>Duration</th><th>Route</th>
              </tr>
            </thead>
            <tbody><!-- items injected --></tbody>
          </table>
        </div>

        <div class="rx-section">
          <h3>Advice / Notes</h3>
          <div id="vNotes" class="small">‚Äî</div>
        </div>

        <div class="rx-footer">
          <div class="small" id="vFollowup">Follow-up: ‚Äî</div>
          <div style="text-align:center">
            <div class="sig-box" id="sigBox" title="Signature"></div>
            <div class="small" id="vDoc2">Dr. Jane Doe</div>
          </div>
        </div>
      </div>
    </section>
  </main>

<script>
(() => {
  // Utilities
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);

  // Inputs
  const inputs = {
    doctorName: $('#doctorName'),
    qualification: $('#qualification'),
    clinic: $('#clinic'),
    contact: $('#contact'),
    patientName: $('#patientName'),
    patientAge: $('#patientAge'),
    gender: $('#gender'),
    date: $('#date'),
    diagnosis: $('#diagnosis'),
    notes: $('#notes'),
    followup: $('#followup'),
    medBody: $('#medBody')
  };

  // Outputs (Preview)
  const out = {
    vDoc: $('#vDoc'), vDoc2: $('#vDoc2'), vQual: $('#vQual'), vClinic: $('#vClinic'), vContact: $('#vContact'),
    vPatient: $('#vPatient'), vAge: $('#vAge'), vGender: $('#vGender'), vDate: $('#vDate'),
    vDiag: $('#vDiag'), vNotes: $('#vNotes'), vFollowup: $('#vFollowup'), vMeds: $('#vMeds').querySelector('tbody')
  };

  // Initialize date to today (local)
  const todayISO = new Date().toISOString().slice(0,10);
  inputs.date.value = todayISO;

  // Live binding function
  function bindLive() {
    out.vDoc.textContent   = valueOrDash(inputs.doctorName.value, 'Dr. Jane Doe');
    out.vDoc2.textContent  = out.vDoc.textContent;
    out.vQual.textContent  = valueOrDash(inputs.qualification.value, 'MBBS, MD (General Medicine)');
    out.vClinic.textContent= valueOrDash(inputs.clinic.value, 'City Hospital');
    out.vContact.textContent = valueOrDash(inputs.contact.value, '+1 234 567 8901 ¬∑ jane@hospital.com');

    out.vPatient.textContent = valueOrDash(inputs.patientName.value, 'John Smith');
    out.vAge.textContent     = valueOrDash(inputs.patientAge.value, '‚Äî');
    out.vGender.textContent  = valueOrDash(inputs.gender.value, '‚Äî');

    out.vDate.textContent = formatDate(inputs.date.value) || formatDate(todayISO);

    out.vDiag.textContent   = valueOrDash(inputs.diagnosis.value, '‚Äî');
    out.vNotes.textContent  = valueOrDash(inputs.notes.value, '‚Äî');
    out.vFollowup.textContent = 'Follow-up: ' + valueOrDash(inputs.followup.value, '‚Äî');
  }
  function valueOrDash(v, fallback='‚Äî'){ return (v && v.trim()) ? v.trim() : fallback; }
  function formatDate(iso){
    if(!iso) return '';
    const d = new Date(iso + 'T00:00:00');
    if (isNaN(d)) return '';
    return d.toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'});
  }

  // Medication row builder
  function addMedRow(data={}){
    const tr = el('tr');
    tr.innerHTML = `
      <td><input placeholder="Amoxicillin 500mg" value="${esc(data.name)}"></td>
      <td><input placeholder="1 tab" value="${esc(data.dose)}"></td>
      <td><input placeholder="TID" value="${esc(data.freq)}" title="e.g., OD, BD, TID, QID"></td>
      <td><input placeholder="5 days" value="${esc(data.dur)}"></td>
      <td><input placeholder="PO" value="${esc(data.route)}" title="e.g., PO, IM, IV, PR, SL"></td>
      <td style="text-align:right">
        <button type="button" class="ghost small" title="Move up">‚Üë</button>
        <button type="button" class="ghost small" title="Move down">‚Üì</button>
        <button type="button" class="ghost small" title="Delete">‚úï</button>
      </td>`;
    // Wire actions
    const [btnUp, btnDown, btnDel] = $$('button', tr);
    btnUp.addEventListener('click', () => {
      if(tr.previousElementSibling) tr.parentElement.insertBefore(tr, tr.previousElementSibling);
      syncMeds();
    });
    btnDown.addEventListener('click', () => {
      if(tr.nextElementSibling) tr.parentElement.insertBefore(tr.nextElementSibling, tr);
      syncMeds();
    });
    btnDel.addEventListener('click', () => { tr.remove(); syncMeds(); });

    // Input listeners to sync preview
    $$('input', tr).forEach(inp => inp.addEventListener('input', syncMeds));
    inputs.medBody.appendChild(tr);
    syncMeds();
    return tr;
  }
  function esc(s){ return (s||'').replace(/"/g,'&quot;'); }

  function syncMeds(){
    // Build preview table body
    out.vMeds.innerHTML = '';
    const rows = $$('#medBody tr');
    rows.forEach(r=>{
      const [name, dose, freq, dur, route] = $$('input', r).map(i=>i.value.trim());
      if(!name && !dose && !freq && !dur && !route) return; // skip empty
      const tr = el('tr');
      [name||'‚Äî', dose||'‚Äî', freq||'‚Äî', dur||'‚Äî', route||'‚Äî'].forEach(txt=>{
        tr.appendChild(el('td', {textContent: txt}));
      });
      out.vMeds.appendChild(tr);
    });
  }

  // Global listeners for live binding
  [
    inputs.doctorName, inputs.qualification, inputs.clinic, inputs.contact,
    inputs.patientName, inputs.patientAge, inputs.gender, inputs.date,
    inputs.diagnosis, inputs.notes, inputs.followup
  ].forEach(inp => inp.addEventListener('input', bindLive));

  // Buttons: Add Med, Common Set, Fill Demo, Clear
  $('#addMed').addEventListener('click', ()=>addMedRow());
  $('#addCommon').addEventListener('click', ()=>{
    const common = [
      {name:'Paracetamol 500mg', dose:'1 tab', freq:'Q6H PRN fever', dur:'3 days', route:'PO'},
      {name:'Cetirizine 10mg',   dose:'1 tab', freq:'OD night',      dur:'5 days', route:'PO'},
      {name:'ORS',               dose:'200 ml',freq:'after loose stool', dur:'as needed', route:'PO'}
    ];
    common.forEach(c=>addMedRow(c));
  });

  $('#fillDemo').addEventListener('click', ()=>{
    inputs.doctorName.value = 'Dr. Jane Doe';
    inputs.qualification.value = 'MBBS, MD (General Medicine)';
    inputs.clinic.value = 'City Hospital, New York';
    inputs.contact.value = '+1 234 567 8901 ¬∑ jane.doe@hospital.com';
    inputs.patientName.value = 'John Smith';
    inputs.patientAge.value = '35';
    inputs.gender.value = 'Male';
    inputs.date.value = todayISO;
    inputs.diagnosis.value = 'Common cold with mild fever.';
    inputs.notes.value = 'Plenty of fluids, rest, steam inhalation. Return if symptoms persist beyond 5 days.';
    inputs.followup.value = 'In 5‚Äì7 days if no improvement.';
    // clear and add meds
    inputs.medBody.innerHTML = '';
    addMedRow({name:'Paracetamol 500mg', dose:'1 tab', freq:'Q6H', dur:'3 days', route:'PO'});
    addMedRow({name:'Vitamin C 500mg', dose:'1 tab', freq:'OD', dur:'7 days', route:'PO'});
    addMedRow({name:'Dextromethorphan syrup', dose:'5 ml', freq:'TID', dur:'5 days', route:'PO'});
    bindLive(); syncMeds();
  });

  $('#clearForm').addEventListener('click', ()=>{
    if(!confirm('Clear all fields?')) return;
    Object.values(inputs).forEach(inp=>{
      if(!inp) return;
      if(inp.tagName === 'INPUT' || inp.tagName === 'TEXTAREA') { inp.value = ''; }
      if(inp.tagName === 'SELECT') { inp.selectedIndex = 0; }
    });
    inputs.date.value = todayISO;
    inputs.medBody.innerHTML = '';
    out.vMeds.innerHTML = '';
    bindLive();
  });

  // Signature: simple click-to-initials (optional)
  const sigBox = $('#sigBox');
  sigBox.addEventListener('click', ()=>{
    const val = prompt('Type your initials or name for signature:');
    sigBox.textContent = '';
    if(val && val.trim()){
      const s = el('div', {textContent: val.trim()});
      s.style.fontFamily = 'cursive';
      s.style.fontSize = '24px';
      s.style.paddingTop = '14px';
      sigBox.appendChild(s);
    }
  });

  // Start with one empty medication row for convenience
  addMedRow();
  bindLive(); syncMeds();
})();
</script>
</body>
</html>
